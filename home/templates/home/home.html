{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block nav%}{% include 'home_nav.html' %}{% endblock %}

<script>



{% block jquery %}

$(document).ready(function(){

// function addItem(){
//     var target_ =
//     target_.prepend( )
// }



  $("#post-form").on('submit', function(event){
  	event.preventDefault();
    var this_ = $(this)
  	console.log("Prevented")
    console.log("this works too")
    console.log($('#post-text').val())
    console.log("this works too")
    var gb_endpoint = this_.attr("data-href")
    console.log(gb_endpoint)
    $.ajax({

      url: gb_endpoint,
      type: "POST",
      data: { message : $("#post-text").val(),
              csrfmiddlewaretoken: '{{ csrf_token }}',
              city: "some city",
              state: "some state",
              // user: '{{ requst.user.username }}',


      },
      success: function(json){
        console.log(json)
        console.log("something here should go wrong")
        $('#post-text').val('');
        $('#post-form').blur();
        var gb_num = $("#gb-num").text();
        console.log(gb_num)
        var new_gb_num = parseInt(gb_num) + 1
        $("#gb-num").text(new_gb_num);


        if (1 == 1){
          var user = json.user
          $('#guest-book-items').prepend('<div class="panel panel-success"><div class="panel-heading">From {% if user.is_authenticated %}{{ user }}{% else %}someone{% endif %} in the ' + json.city + ', ' + json.state + ' area | just now</div><div class="panel-body">' + json.message + '</div></div>')


        }




        console.log(json);
        console.log("success");
      },

    })
  })
})


{% endblock %}
</script>


{% block content %}

    <div class="col-md-8">    <!-- Main jumbotron for a primary marketing message or call to action -->
      <div class="jumbotron">
        <h1>Welcome! üéâ</h1>
        <p>This is Brian Caffey's personal website. Thanks for visiting!</p>
        <p>Your IP is {{ ip }}{% if city %}, and you are in {{ city }}, {{ state }}{% endif %}.</p>
        <a href="{% url 'srgraph:srgraph' %}" class="btn btn-warning">check out my most recent project!</a>
      </div>

      <h4>Interested in writing a guest post? Anyone can contribute to my blog. {% if user.is_authenticated %}<a href="{% url 'posts:create' %}">Get started now!</a>{% else %}<a href="{% url 'accounts:login' %}">Login</a> or <a href="{% url 'accounts:register' %}">register</a> now and start writing your first post.{% endif %}</h4>

      <h2 style="text-align:center;">Hello, world. üåéüåçüåè</h2>
      <h2 style="text-align:center;">{% include 'home/flags.html' %}</h2>
      <hr>
      <h2 style="text-align:center;">Sign my <a href="{% url 'home:gb-list' %}">guest book</a>&nbsp;üììüñä</h2>


      <form style="text-align:center;" id="post-form" data-href="/api/gb-submit/" method="POST" action=".">{% csrf_token %}
        {{ guest_form | crispy }}
        <input type="submit" id="post-form post-button" class="btn btn-success" value="Add note"><br/> -or- <br/><a class="btn btn-info" href="{% url 'home:gb-submit' %}">Sign guestbook through the Django REST framework</a>
      </form>

      <span id="guest-book-items">
      {% for note in guest_book %}

      <div class="panel panel-success">
        <div class="panel-heading">{% if note.user %}From {{ note.user }}{% if note.city %} in the {{ note.city }}, {{ note.state }} area{% endif %}{% else %}From someone{% if note.city %} in the {{ note.city }}, {{ note.state }} area{% endif %}{% endif %} | {{ note.date_created | timesince }}</div>
        <div class="panel-body">{{ note.message }}</div>
      </div>
      {% endfor %}
      </span>

      <h3>View <a href="{% url 'home:gb-list' %}">all <span id="gb-num">{{ guest_book_count }}</span> notes</a> in my guestbook</h3>
    </div>

    <div class="col-md-4" id="right-side">
        <h3>Join my monthly newsletter! üóû</h3>
        <form method="POST" action=".">{% csrf_token %}
          {{ form_ | crispy }}
        <input class="btn btn-success" type="submit" name="Join"></input>
      </form>
      <hr>

      <blockquote class="instagram-media" data-instgrm-version="7" style=" background:#FFF; border:0; border-radius:3px; box-shadow:0 0 1px 0 rgba(0,0,0,0.5),0 1px 10px 0 rgba(0,0,0,0.15); margin: 1px; max-width:658px; padding:0; width:99.375%; width:-webkit-calc(100% - 2px); width:calc(100% - 2px);"><div style="padding:8px;"> <div style=" background:#F8F8F8; line-height:0; margin-top:40px; padding:62.4537037037037% 0; text-align:center; width:100%;"> <div style=" background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAMAAAApWqozAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAMUExURczMzPf399fX1+bm5mzY9AMAAADiSURBVDjLvZXbEsMgCES5/P8/t9FuRVCRmU73JWlzosgSIIZURCjo/ad+EQJJB4Hv8BFt+IDpQoCx1wjOSBFhh2XssxEIYn3ulI/6MNReE07UIWJEv8UEOWDS88LY97kqyTliJKKtuYBbruAyVh5wOHiXmpi5we58Ek028czwyuQdLKPG1Bkb4NnM+VeAnfHqn1k4+GPT6uGQcvu2h2OVuIf/gWUFyy8OWEpdyZSa3aVCqpVoVvzZZ2VTnn2wU8qzVjDDetO90GSy9mVLqtgYSy231MxrY6I2gGqjrTY0L8fxCxfCBbhWrsYYAAAAAElFTkSuQmCC); display:block; height:44px; margin:0 auto -44px; position:relative; top:-22px; width:44px;"></div></div><p style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; line-height:17px; margin-bottom:0; margin-top:8px; overflow:hidden; padding:8px 0 7px; text-align:center; text-overflow:ellipsis; white-space:nowrap;"><a href="https://www.instagram.com/p/BCgVROTyFdJ/" style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:normal; line-height:17px; text-decoration:none;" target="_blank">A post shared by Brian (@briancaffey)</a> on <time style=" font-family:Arial,sans-serif; font-size:14px; line-height:17px;" datetime="2016-03-03T21:00:35+00:00">Mar 3, 2016 at 1:00pm PST</time></p></div></blockquote>

      <script async defer src="//platform.instagram.com/en_US/embeds.js"></script>

      <hr>

      <h3>Send me bitcoin</h3>
      {% include 'bitcoin.html' %}

      <h3>Recent blog posts</h3>
      {% for post in recent_posts %}
      <h4><a href="{% url 'posts:detail' slug=post.slug %}">{{ post.title }}</a></h4>
      <p>{{ post.comments.all.count }} üí¨&nbsp;&nbsp; {{ post.likes.all.count }}üëç</p>
      {% endfor %}

      <hr>
      <blockquote class="instagram-media" data-instgrm-captioned data-instgrm-version="7" style=" background:#FFF; border:0; border-radius:3px; box-shadow:0 0 1px 0 rgba(0,0,0,0.5),0 1px 10px 0 rgba(0,0,0,0.15); margin: 1px; max-width:658px; padding:0; width:99.375%; width:-webkit-calc(100% - 2px); width:calc(100% - 2px);"><div style="padding:8px;"> <div style=" background:#F8F8F8; line-height:0; margin-top:40px; padding:50.0% 0; text-align:center; width:100%;"> <div style=" background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAMAAAApWqozAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAMUExURczMzPf399fX1+bm5mzY9AMAAADiSURBVDjLvZXbEsMgCES5/P8/t9FuRVCRmU73JWlzosgSIIZURCjo/ad+EQJJB4Hv8BFt+IDpQoCx1wjOSBFhh2XssxEIYn3ulI/6MNReE07UIWJEv8UEOWDS88LY97kqyTliJKKtuYBbruAyVh5wOHiXmpi5we58Ek028czwyuQdLKPG1Bkb4NnM+VeAnfHqn1k4+GPT6uGQcvu2h2OVuIf/gWUFyy8OWEpdyZSa3aVCqpVoVvzZZ2VTnn2wU8qzVjDDetO90GSy9mVLqtgYSy231MxrY6I2gGqjrTY0L8fxCxfCBbhWrsYYAAAAAElFTkSuQmCC); display:block; height:44px; margin:0 auto -44px; position:relative; top:-22px; width:44px;"></div></div> <p style=" margin:8px 0 0 0; padding:0 4px;"> <a href="https://www.instagram.com/p/6GPvYtSFVU/" style=" color:#000; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:normal; line-height:17px; text-decoration:none; word-wrap:break-word;" target="_blank">#agustinbarrios #barrios #classicalguitar #paraguayanmusic #nitsuga Vals Op. 8 No. 3 with crickets on rhythm in the background #hydrangea #guitar #practice</a></p> <p style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; line-height:17px; margin-bottom:0; margin-top:8px; overflow:hidden; padding:8px 0 7px; text-align:center; text-overflow:ellipsis; white-space:nowrap;">A post shared by Brian (@briancaffey) on <time style=" font-family:Arial,sans-serif; font-size:14px; line-height:17px;" datetime="2015-08-07T21:40:52+00:00">Aug 7, 2015 at 2:40pm PDT</time></p></div></blockquote>
      <script async defer src="//platform.instagram.com/en_US/embeds.js"></script>

      <hr>
      <blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">&quot;When you reach the end of your rope, tie a knot in it and hang on.&quot; -- Thomas Jefferson</p>&mdash; Brian Caffey (@briancaffey) <a href="https://twitter.com/briancaffey/status/715632338059796480">March 31, 2016</a></blockquote>
      <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

    </div>

{% endblock %}
